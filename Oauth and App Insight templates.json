{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "apiManagementServiceName": {
      "type": "string",
      "minLength": 1,
      "metadata": {
        "description": "Name of the API Management service"
      }
    }
  },
  "resources": [
    {
	 "name": "[concat(parameters('apiManagementServiceName'),'/applicationinsights')]",
	  "type": "Microsoft.ApiManagement/service/diagnostics",
	  "apiVersion": "2018-06-01-preview",
	  "properties": {
		"enabled": false,
		"loggerId": "/loggers/harryappinsight",
        "alwaysLog": "allErrors",
	    "sampling": {
		  "samplingType": "fixed",
		  "percentage": "95"
        },
		"frontend":{
			"request":{
				"body": {
					"bytes": "1024"
				}
			},
			"response":{
				"body": {
					"bytes": "1024"
				}
			}
		},
		"backend":{
			"request":{
				"body": {
					"bytes": "1024"
				}
			},
			"response":{
				"body": {
					"bytes": "1024"
				}
			}
		}
	  },
	},
	{
      "apiVersion": "2018-01-01",
      "type": "Microsoft.ApiManagement/service/authorizationServers",
      "name": "[concat(parameters('apiManagementServiceName'),'/test2')]",
       "properties": {
			"displayName": "test2",
			"description": "test server",
			"clientRegistrationEndpoint": "https://www.contoso.com/apps",
			"authorizationEndpoint": "https://www.contoso.com/oauth2/auth",
			"authorizationMethods": [
			  "GET"
			],
			"tokenEndpoint": "https://www.contoso.com/oauth2/token",
			"supportState": true,
			"defaultScope": "read write",
			"grantTypes": [
			  "authorizationCode",
			  "implicit"
			],
			"bearerTokenSendingMethods": [
			  "authorizationHeader"
			],
			"clientId": "1",
			"clientSecret": "2",
			"resourceOwnerUsername": "un",
			"resourceOwnerPassword": "pwd"
	  }
    }
  ]
}